<?php/** * People Just Walking Dead. *  * @author  ZeroBoy  * @version 1.0 * @model 登录模块 */ namespace Home\Controller;use Think\Controller;class LoginController extends Controller {	public 	/**	 * 登录页面.	 */	function index()	{		$this->display();  	} // end func	public 	/**	 * 去登陆.	 */	function DoLogin()	{	   $user = I('post.user'); 	   $pwd = I('post.pwd');	   $verify = I('post.verify');	   $verifyobject = new VerifyController();	   $checkres = $verifyobject->CheckVerify($verify,1);	   $data['User'] = $user;	   $data['Pwd'] = $pwd;	   $datas = $this->FillLoginData($data);	   if($datas['status']>0){			$where = "user_account='".$data['User']."' and  ";			$where .= "user_pwd='".md5($data['Pwd'])."' ";			$UserModel = M('user');			$isuser = $UserModel->where($where)->count();			if($isuser>0){				$userinfo = $UserModel->where($where)->select();				session('userinfo',$userinfo[0]);				$TokenTime = time();				session('tokentime',$TokenTime);//登录时间点				$this->assign("jumpUrl",U('Index/index','',false));				$this->success("登录成功！");			}else{				$this->assign("jumpUrl",U('Login/index','',false));				$this->error("登录失败，请重试！");			}	   }else{			$this->assign("jumpUrl",U('Login/index','',false));			$this->error($datas['msg']);	   }	} // end func	private 	/**	 * 登录参数过滤.	 */	function FillLoginData($data)	{		if(	 empty($data['User']) || (strlen($data['User'] )==0) || ($data['User'] ==null)){			return array("status"=>-1,"msg"=>"用户名不能为空");  		}		if(	 empty($data['Pwd']) || (strlen($data['Pwd'] )==0) || ($data['Pwd'] ==null)){			return array("status"=>-1,"msg"=>"密码不能为空");  		}	  return array("status"=>1,"content"=>$data);  	} // end func	//登出账号	public function LoginOut(){			//清空所有session		session(null);		$this->assign("jumpUrl",U('Login/index','',false));		$this->success("登出成功！");	}}?>